(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19dd620d","chunk-2c623354"],{"1f34":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("userForm",{ref:"form",attrs:{"is-add":e.isAdd}}),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{xs:9,sm:6,md:4,lg:4,xl:4}},[n("div",{staticClass:"head-container"},[n("el-input",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"输入部门搜索","prefix-icon":"el-icon-search"},on:{input:e.getDeptDatas},model:{value:e.deptName,callback:function(t){e.deptName=t},expression:"deptName"}})],1),e._v(" "),n("el-tree",{attrs:{data:e.depts,props:e.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),n("el-col",{attrs:{xs:15,sm:18,md:20,lg:20,xl:20}},[n("div",{staticClass:"head-container"},[n("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"输入用户名或者邮箱搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.toQuery(t)}},model:{value:e.query.blurry,callback:function(t){e.$set(e.query,"blurry",t)},expression:"query.blurry"}}),e._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"90px"},attrs:{clearable:"",placeholder:"状态"},on:{change:e.toQuery},model:{value:e.query.enabled,callback:function(t){e.$set(e.query,"enabled",t)},expression:"query.enabled"}},e._l(e.enabledTypeOptions,(function(e){return n("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})})),1),e._v(" "),n("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"success",icon:"el-icon-search"},on:{click:e.toQuery}},[e._v("搜索")]),e._v(" "),n("div",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_CREATE"],expression:"['ADMIN','USER_ALL','USER_CREATE']"}],staticStyle:{display:"inline-block",margin:"0px 2px"}},[n("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")])],1),e._v(" "),n("div",{staticStyle:{display:"inline-block"}},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_SELECT"],expression:"['ADMIN','USER_ALL','USER_SELECT']"}],staticClass:"filter-item",attrs:{loading:e.downloadLoading,size:"mini",type:"warning",icon:"el-icon-download"},on:{click:e.download}},[e._v("导出")])],1)],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.data,size:"small","max-width":"250"}},[n("af-table-column",{attrs:{prop:"id",fixed:"",label:"编号"}}),e._v(" "),n("af-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),n("af-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),n("af-table-column",{attrs:{prop:"phone",label:"电话"}}),e._v(" "),n("af-table-column",{attrs:{label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.sex?n("span",[e._v("女")]):n("span",[e._v("男")])]}}])}),e._v(" "),n("af-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"email",label:"邮箱"}}),e._v(" "),n("af-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.enabledTypeOptions,(function(a){return n("div",{key:a.id},[t.row.enabled===a.key?n("el-tag",{attrs:{type:t.row.enabled?"":"info"}},[e._v(e._s(a.display_name))]):e._e()],1)}))}}])}),e._v(" "),n("af-table-column",{attrs:{label:"职位"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v(e._s(t.row.dept.name)+" / "+e._s(t.row.job.name))])]}}])}),e._v(" "),n("af-table-column",{attrs:{prop:"address",label:"地址"}}),e._v(" "),n("af-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"createTime",label:"创建日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),e._v(" "),e.checkPermission(["ADMIN","USER_ALL","USER_EDIT","USER_DELETE"])?n("af-table-column",{attrs:{fixed:"",label:"操作",width:"125",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_EDIT"],expression:"['ADMIN','USER_ALL','USER_EDIT']"}],attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(n){return e.edit(t.row)}}}),e._v(" "),n("el-popover",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_DELETE"],expression:"['ADMIN','USER_ALL','USER_DELETE']"}],ref:t.row.id,attrs:{placement:"top",width:"180"}},[n("p",[e._v("确定删除本条数据吗？")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){e.$refs[t.row.id].doClose()}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(n){return e.subDelete(t.row.id)}}},[e._v("确定")])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}],null,!1,4192305934)}):e._e()],1),e._v(" "),n("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.total,"current-page":e.page,layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1)],1)},r=[],i=(n("ac6a"),n("7f7f"),n("e350")),o=n("d6f1"),s=n("c24f"),l=n("ed08"),d=n("fe05"),u=n("ccbf"),c={name:"User",components:{userForm:u["default"]},mixins:[o["a"]],data:function(){return{height:document.documentElement.clientHeight-180+"px;",isAdd:!1,delLoading:!1,deptName:"",depts:[],deptId:null,defaultProps:{children:"children",label:"name"},downloadLoading:!1,sexOptions:[{key:"0",display_name:"男"},{key:"1",display_name:"女"}],enabledTypeOptions:[{key:!0,display_name:"激活"},{key:!1,display_name:"锁定"}]}},created:function(){var e=this;this.getDeptDatas(),this.$nextTick((function(){e.init()}))},mounted:function(){var e=this;window.onresize=function(){e.height=document.documentElement.clientHeight-180+"px;"}},methods:{parseTime:l["d"],checkPermission:i["a"],beforeInit:function(){this.url="api/users";var e=this.query,t=e.blurry;this.params={page:this.page,size:this.size,deptId:this.deptId},t&&(this.params["blurry"]=t);var n=e.enabled;return""!==n&&null!==n&&(this.params["enabled"]=n),!0},subDelete:function(e){var t=this;this.delLoading=!0,Object(s["c"])(e).then((function(n){t.delLoading=!1,t.$refs[e].doClose(),t.dleChangePage(),t.init(),t.$notify({title:"删除成功",type:"success",duration:2500})})).catch((function(n){t.delLoading=!1,t.$refs[e].doClose(),console.log(n.response.data.message)}))},getDeptDatas:function(){var e=this,t="id",n={sort:t};this.deptName&&(n["name"]=this.deptName),Object(d["d"])(n).then((function(t){e.depts=t.content}))},handleNodeClick:function(e){0===e.pid?this.deptId=null:this.deptId=e.id,this.init()},add:function(){this.isAdd=!0,this.$refs.form.getDepts(),this.$refs.form.getRoles(),this.$refs.form.getRoleLevel(),this.$refs.form.dialog=!0},download:function(){var e=this;this.downloadLoading=!0,Object(s["d"])().then((function(t){Object(l["b"])(t,"用户列表","xlsx"),e.downloadLoading=!1})).catch((function(){e.downloadLoading=!1}))},formatJson:function(e,t){return t.map((function(t){return e.map((function(e){return"createTime"===e||"lastPasswordResetTime"===e?Object(l["d"])(t[e]):"enabled"===e?Object(l["d"])(t[e])?"启用":"禁用":t[e]}))}))},edit:function(e){console.log(e),this.isAdd=!1;var t=this.$refs.form;t.getRoles(),t.getDepts(),t.getRoleLevel(),t.roleIds=[],t.form={id:e.id,username:e.username,name:e.name,phone:e.phone,email:e.email,sex:e.sex,enabled:e.enabled,address:e.address,roles:[],dept:{id:e.dept.id},job:{id:e.job.id}},e.roles.forEach((function(e,n){t.roleIds.push(e.id)})),t.deptId=e.dept.id,t.jobId=e.job.id,t.getJobs(t.deptId),t.dialog=!0}}},p=c,f=n("2877"),m=Object(f["a"])(p,a,r,!1,null,"17152f7a",null);t["default"]=m.exports},"76fe":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s}));var a=n("b775");function r(e){var t={deptId:e,page:0,size:9999};return Object(a["a"])({url:"api/job",method:"get",params:t})}function i(e){return Object(a["a"])({url:"api/job",method:"post",data:e})}function o(e){return Object(a["a"])({url:"api/job/"+e,method:"delete"})}function s(e){return Object(a["a"])({url:"api/job",method:"put",data:e})}},"7b0a":function(e,t,n){"use strict";function a(e,t,n){""==t||void 0==t||null==t?n():t.length<5||t.length>32?n(new Error("请输入正确的账号格式")):n()}function r(e,t,n){var a=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/;""==t||void 0==t||null==t?n():a.test(t)?n():n(new Error("密码由在8到16位数字和字母组成"))}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}))},c24f:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n("b775");function r(e){return Object(a["a"])({url:"api/users",method:"post",data:e})}function i(){return Object(a["a"])({url:"api/users/download",method:"get",responseType:"blob"})}function o(e){return Object(a["a"])({url:"api/users/"+e,method:"delete"})}function s(e){return Object(a["a"])({url:"api/users",method:"put",data:e})}function l(e){var t={oldPassword:e.oldPass,newPassword:e.newPass};return Object(a["a"])({url:"api/users/changePsd",method:"post",data:t})}},cc5e:function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return c}));var a=n("b775");function r(){return Object(a["a"])({url:"api/roles/all",method:"get"})}function i(e){return Object(a["a"])({url:"api/roles",method:"post",data:e})}function o(e){return Object(a["a"])({url:"api/roles/"+e,method:"get"})}function s(){return Object(a["a"])({url:"api/roles/level",method:"get"})}function l(e){return Object(a["a"])({url:"api/roles/"+e,method:"delete"})}function d(e){return Object(a["a"])({url:"api/roles",method:"put",data:e})}function u(e){return Object(a["a"])({url:"api/roles/permission",method:"put",data:e})}function c(e){return Object(a["a"])({url:"api/roles/menu",method:"put",data:e})}},ccbf:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.dialog,"close-on-click-modal":!1,"before-close":e.cancel,title:e.isAdd?"新增用户":"编辑用户","append-to-body":"",width:"570px"},on:{"update:visible":function(t){e.dialog=t}}},[n("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,size:"small","label-width":"66px"}},[n("el-form-item",{attrs:{label:"账号",prop:"username"}},[n("el-input",{attrs:{disabled:!e.isAdd},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"姓名",prop:"name"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"状态",prop:"enabled"}},e._l(e.enabledTypeOptions,(function(t){return n("el-radio",{key:t.id,attrs:{label:t.key},model:{value:e.form.enabled,callback:function(t){e.$set(e.form,"enabled",t)},expression:"form.enabled"}},[e._v(e._s(t.display_name))])})),1),e._v(" "),n("el-form-item",{attrs:{label:"电话",prop:"phone"}},[n("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",e._n(t))},expression:"form.phone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"性别",prop:"enabled"}},e._l(e.sexOptions,(function(t){return n("el-radio",{key:t.id,attrs:{label:t.key},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v(e._s(t.display_name))])})),1),e._v(" "),n("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[n("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),n("el-form-item",{attrs:{required:"",label:"部门"}},[n("treeselect",{staticStyle:{width:"178px"},attrs:{options:e.depts,placeholder:"选择部门"},on:{select:e.selectFun},model:{value:e.deptId,callback:function(t){e.deptId=t},expression:"deptId"}})],1),e._v(" "),n("el-form-item",{attrs:{required:"",label:"岗位"}},[n("el-select",{staticStyle:{width:"178px"},attrs:{placeholder:"请先选择部门"},model:{value:e.jobId,callback:function(t){e.jobId=t},expression:"jobId"}},e._l(e.jobs,(function(e,t){return n("el-option",{key:e.name+t,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{required:"",label:"角色"}},[n("el-select",{staticStyle:{width:"450px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},e._l(e.roles,(function(t,a){return n("el-option",{key:t.name+a,attrs:{disabled:1!==e.level&&t.level<=e.level,label:t.name,value:t.id}})})),1)],1),e._v(" "),n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"地址"}},[n("el-input",{staticStyle:{width:"450px"},attrs:{type:"textarea",rows:2,maxlength:"90","show-word-limit":"",placeholder:"请输入具体地址",clearable:""},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)},r=[],i=(n("ac6a"),n("c24f")),o=n("fe05"),s=n("cc5e"),l=n("7b0a"),d=n("76fe"),u=n("ca17"),c=n.n(u),p=(n("542c"),{components:{Treeselect:c.a},props:{isAdd:{type:Boolean,required:!0}},data:function(){var e=this,t=function(t,n,a){n?e.isvalidPhone(n)?a():a(new Error("请输入正确的11位手机号码")):a(new Error("请输入电话号码"))};return{dialog:!1,loading:!1,form:{name:"",username:"",email:"",sex:"0",enabled:!1,address:"",roles:[],job:{id:""},dept:{id:""},phone:null},roleIds:[],roles:[],depts:[],deptId:null,jobId:null,jobs:[],level:3,sexOptions:[{key:"0",display_name:"男"},{key:"1",display_name:"女"}],enabledTypeOptions:[{key:!0,display_name:"激活"},{key:!1,display_name:"锁定"}],rules:{username:[{required:!0,trigger:"blur",message:"用户名不能为空"},{validator:l["b"],trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:14,message:"长度在 2 到 14 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,trigger:"blur",validator:t}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.form.dept.id=this.deptId,this.form.job.id=this.jobId,this.$refs["form"].validate((function(t){if(!t)return!1;if(null===e.deptId||void 0===e.deptId)e.$message({message:"部门不能为空",type:"warning"});else if(null===e.jobId)e.$message({message:"岗位不能为空",type:"warning"});else if(0===e.roleIds.length)e.$message({message:"角色不能为空",type:"warning"});else{e.loading=!0,e.form.roles=[];var n=e;e.roleIds.forEach((function(e,t){var a={id:e};n.form.roles.push(a)})),e.isAdd?e.doAdd():e.doEdit()}}))},doAdd:function(){var e=this;Object(i["a"])(this.form).then((function(t){e.resetForm(),e.$notify({title:"添加成功",message:"默认密码：abc123456",type:"success",duration:2500}),e.loading=!1,e.$parent.init()})).catch((function(t){e.loading=!1,console.log(t.response.data.message)}))},doEdit:function(){var e=this;Object(i["e"])(this.form).then((function(t){e.resetForm(),e.$notify({title:"修改成功",type:"success",duration:2500}),e.loading=!1,e.$parent.init()})).catch((function(t){e.loading=!1,console.log(t.response.data.message)}))},resetForm:function(){this.dialog=!1,this.$refs["form"].resetFields(),this.deptId=null,this.jobId=null,this.roleIds=[],this.form={username:"",email:"",sex:"0",enabled:!1,roles:[],job:{id:""},dept:{id:""},phone:null}},getRoles:function(){var e=this;Object(s["g"])().then((function(t){e.roles=t.content})).catch((function(e){console.log(e.response.data.message)}))},getJobs:function(e){var t=this;Object(d["d"])(e).then((function(e){t.jobs=e.content})).catch((function(e){console.log(e.response.data.message)}))},getDepts:function(){var e=this;Object(o["d"])().then((function(t){e.depts=t.content}))},isvalidPhone:function(e){var t=/^1[3|4|5|7|8][0-9]\d{8}$/;return t.test(e)},selectFun:function(e,t){this.getJobs(e.id)},getRoleLevel:function(){var e=this;Object(s["h"])().then((function(t){e.level=t.level})).catch((function(e){console.log(e.response.data.message)}))}}}),f=p,m=n("2877"),b=Object(m["a"])(f,a,r,!1,null,"f56f19da",null);t["default"]=b.exports},d6f1:function(e,t,n){"use strict";n("96cf");var a=n("3b8d"),r=n("b775");function i(e,t){return Object(r["a"])({url:e,method:"get",params:t})}t["a"]={data:function(){return{loading:!0,data:[],page:1,size:10,total:0,url:"",params:{},query:{},time:170,isAdd:!1}},methods:{init:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.beforeInit();case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e,n){t.loading=!0,i(t.url,t.params).then((function(n){t.total=parseInt(n.totalElements),t.data=n.content,setTimeout((function(){t.loading=!1}),t.time),e(n)})).catch((function(e){t.loading=!1,n(e)}))})));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),beforeInit:function(){return!0},pageChange:function(e){this.page=e,this.init()},sizeChange:function(e){this.page=1,this.size=e,this.init()},dleChangePage:function(e){void 0===e&&(e=1),this.data.length===e&&0!==this.page&&(this.page=this.page-1)},toQuery:function(){this.page=0,this.init()}}}},e350:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("6762"),n("2fdb");var a=n("4360");function r(e){if(e&&e instanceof Array&&e.length>0){var t=a["a"].getters&&a["a"].getters.roles,n=e,r=t.some((function(e){return n.includes(e)}));return!!r}return!1}},fe05:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));var a=n("b775");function r(e){return Object(a["a"])({url:"api/dept",method:"get",params:e})}function i(e){return Object(a["a"])({url:"api/dept",method:"post",data:e})}function o(e){return Object(a["a"])({url:"api/dept",method:"put",data:e})}function s(e){return Object(a["a"])({url:"api/dept/"+e,method:"delete"})}}}]);